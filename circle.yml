machine:
  environment:
    # GOROOT is not set by default
    GOROOT: ""
    PATH: "/usr/local/go/bin:~/.go_workspace/bin:${PATH}"
    GOPATH: "${HOME}/.go_workspace"
    ROOT_PATH: "${GOPATH}/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}"
dependencies:
  override:
    - echo ${GOPATH}
    - mkdir -p ${GOPATH}/src/github.com/${CIRCLE_PROJECT_USERNAME}
    - ln -s ${HOME}/${CIRCLE_PROJECT_REPONAME} ${ROOT_PATH}
    - go get -u github.com/kardianos/govendor
    - govendor get github.com/gohugoio/hugo
    - go install github.com/gohugoio/hugo

test:
  override:
    - echo "no test"

deployment:
  production:
    branch: master
    commands:
      - git config --global user.name "yoshihara at CircleCI"
      - git config --global user.email "yoshihara@users.noreply.github.com"
      - git submodule update -i
      - hugo
      - git --git-dir=${ROOT_PATH}/public/.git add --all :/
      - git --git-dir=${ROOT_PATH}/public/.git commit -m "Update by CircleCI"
      - git --git-dir=${ROOT_PATH}/public/.git push --force-with-lease origin HEAD:master
