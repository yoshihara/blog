<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <title>Ergo42 towel組み立てたときのメモ | hyoshi(hara) log</title>
    
    <meta property='og:title' content='Ergo42 towel組み立てたときのメモ - hyoshi(hara) log'>
<meta property='og:description' content='はんだごてとか触ったのいつぶりかわからないぐらいですが、一度作ってみたかったので。 （ホームポジションぐらい違うキーキャップにすればよかったか'>
<meta property='og:url' content='https://blog.bomberowl.org/posts/442/'>
<meta property='og:site_name' content='hyoshi(hara) log'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2019-01-02T22:13:04&#43;09:00'/><meta property='article:modified_time' content='2019-01-02T22:13:04&#43;09:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@hyoshihara04'><meta name='twitter:creator' content='@hyoshihara04'>
    
    <link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://blog.bomberowl.org/css/custom.css'><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>

<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://blog.bomberowl.org">
          <h1 class="title is-4">hyoshi(hara) log</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/yoshihara'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/hyoshihara04'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    <h2 class="subtitle is-6">January 2, 2019</h2>
    <h1 class="title">Ergo42 towel組み立てたときのメモ</h1>
    
    <div class="content">
      

<p>はんだごてとか触ったのいつぶりかわからないぐらいですが、一度作ってみたかったので。</p>

<p><img src="https://img.esa.io/uploads/production/attachments/1303/2019/01/02/144/a6b841ba-b1a9-49f6-b4cd-50210ff37ff1.jpg" alt="IMG_20190102_143718.jpg (623.3 kB)" /></p>

<p>（ホームポジションぐらい違うキーキャップにすればよかったかもしれない&hellip;今から買い足そうかな&hellip;）</p>

<p><a href="https://booth.pm/ja/items/952695">https://booth.pm/ja/items/952695</a> のフルセット透明を買ってからしばらく経ってしまっていたのですが、年末から年始にかけて組み立ててみました。
ほぼ他の方のビルドログを見て作った感じなので、その参考にしたサイトや自分でメモしてた部分などと、ファームウェア書き込みではまったところをメモします。</p>

<p>なお、セットに入っていない部品のうち、キースイッチは遊舎工房さんで <a href="https://yushakobo.jp/shop/a02te/">R11 Tiffany Blue Tealios</a>、 キーキャップは pimpmykeyboard で <a href="https://pimpmykeyboard.com/dsa-1-space-pack-of-10/">DSA 1 SPACE (PACK OF 10)</a>のBCTを買いました。</p>

<h2 id="参考にしたサイト">参考にしたサイト</h2>

<ul>
<li><a href="https://qiita.com/zk_phi/items/3180902a37fa73223020">自作キーボード (Ergo42) を組み立てた</a></li>
<li><a href="https://s12bt.hatenablog.com/entry/build-ergo42Towel">Ergo42 Towelビルドログ</a></li>
</ul>

<p>ほぼそのまま見よう見まねでつくりました。ただ1つ目のサイトはErgo42（Towelじゃないほう）のビルドログっぽい？　ので導通やProMicroの取り付けなどがTowelと違うところがあります。それでも全体の流れとかがとても参考になりました :pray:</p>

<h2 id="作業メモ">作業メモ</h2>

<h3 id="抵抗値-導通確認ポイント">抵抗値・導通確認ポイント</h3>

<ul>
<li>ダイオードのはんだ付けミスってないか</li>
<li>スイッチのはんだ付けミスってないか</li>
</ul>

<p>あたりをテスターでチェックすると安心するのでまとめてみます。（参考にしたサイトさんで大体わかるのですがせっかく写真撮ったのでまとめたかった）TRRSジャックの導通チェックは忘れてました&hellip;。</p>

<p>なおテスターは <a href="https://www.amazon.co.jp/gp/product/B005BE4XZS">https://www.amazon.co.jp/gp/product/B005BE4XZS</a> を使いました。</p>

<h4 id="ダイオードの抵抗値">ダイオードの抵抗値</h4>

<p>スイッチ側に赤、↓の画像の方に黒を当てました。ダイオード単独での抵抗値とほぼ変わりがなければOK。（しかし写真めっちゃボケている。。。）</p>

<p>左側</p>

<p><img src="https://img.esa.io/uploads/production/attachments/1303/2019/01/02/144/f5c74b84-1790-4cb3-b409-589cdf319a4b.jpg" alt="IMG_20181224_182850.jpg (351.1 kB)" /></p>

<p>右側</p>

<p><img src="https://img.esa.io/uploads/production/attachments/1303/2019/01/02/144/4db601ea-15e8-4966-88e9-6c48a7e57487.png" alt="image.png (2.5 MB)" /></p>

<h4 id="タクトスイッチの導通">タクトスイッチの導通</h4>

<p>片側しかメモが残ってなかったのですが位置的に左右対称になっているはず。（たぶんダイオードの抵抗値も左右対称のはずですが、片方が裏面が上に来る関係であんまりそう見えない気がする）</p>

<p>写真の位置にテスターを当てて導通していればOK。（私が使ったやつだと音が鳴ったらOK）</p>

<p><img src="https://img.esa.io/uploads/production/attachments/1303/2019/01/02/144/ca06f2c9-d520-45ac-9715-3e68988cde00.png" alt="image.png (5.7 MB)" /></p>

<h3 id="その他">その他</h3>

<p>なんかあったときに切り分けしたいので、スイッチをはめる前にスイッチの導通も1つ1つやりました。</p>

<h2 id="組み立てで大変だったところ">組み立てで大変だったところ</h2>

<ul>
<li>最初、タクトスイッチを裏表逆につけてしまい、必死こいて外しました

<ul>
<li>買っといてよかったハンダ吸い取り器</li>
</ul></li>
<li>はんだの付け方はおぼろげな記憶でやると危険な気がしたので、いろいろ動画見たり調べたりしました。個人的には流し込む感覚が大事っぽい印象</li>
<li>ProMicroはめるときに足がうまく入らなくて悪戦苦闘したあげく、なかば無理やり突っ込んだのですが、これってもっとスムーズに入るものなんですかね&hellip;まあ私の足の付け方がへたくそなだけだった気もする&hellip;</li>
</ul>

<p>キースイッチはめてるときの写真兼ProMicroの向きメモ
<img src="https://img.esa.io/uploads/production/attachments/1303/2019/01/02/144/23c4e456-ff63-4eb9-94e6-3e5cb8a8852d.jpg" alt="IMG_20181224_220802.jpg (787.7 kB)" /></p>

<h2 id="ファームウェア書き込みできなかった件の対応-追記あり">ファームウェア書き込みできなかった件の対応（追記あり）</h2>

<p>組み立ててMacに接続したものの、ProMicroのLEDはつくもののキースイッチは1つも反応せず、適当に当たりをつけていろいろやってたら解決したのでその顛末を書きます。twitterで作者の方（ @Biacco42 さん）にも教えていただいたりしたのでのちほどこの記事のURLを持ってご報告に行かねば&hellip;。</p>

<p>（ここから追記）
<a href="https://github.com/qmk/qmk_toolbox#macos">https://github.com/qmk/qmk_toolbox#macos</a> をやり直してみたところ、どうやら <code>brew tap PX4/homebrew-px4</code> を忘れていたようで、これを実行して再インストールしたら動きました。。以降はそれに気づいてないときに色々やったものになります。Arch Linuxでのビルドのときにやることみたいな感じで読んでいただけると幸いです。
（ここまで追記）</p>

<h3 id="環境">環境</h3>

<ul>
<li>Mac

<ul>
<li>Mojave <code>10.14.2</code></li>
</ul></li>
<li>Arch linux（以下arch）

<ul>
<li>avr-gcc <code>8.2.0-1-x86_64</code> -&gt; <code>8.1.0-1-x86_64</code>（ダウングレードの理由については後述）</li>
<li>AURヘルパーは <code>yay</code> v9.0.1 - libalpm v11.0.1 を使っています</li>
</ul></li>
</ul>

<p>またMac/archどちらもファームウェアに書き込む <code>avrdude</code> のバージョンは6.3でした。</p>

<h3 id="作業の流れ">作業の流れ</h3>

<p>最初はMacでファームウェアを書き込もうとして、<a href="https://github.com/Biacco42/Ergo42/blob/f5a96fd99ce9fd405074c3dab1e6b65412da1b76/README.md">GitHubのドキュメント</a> を見てコマンドを叩きました。
しかし <code>make ergo42/rev1:default:avrdude</code> の実行中、キーボードを認識した後 <code>avrdude: butterfly_recv() programmer is not responding</code> というエラーが出ました。何かしらの応答が帰ってこないので書き込みができていない模様。</p>

<p>なんとなくハードウェア書き込む系はOSによって色々ある気がしたので、環境依存でないことを確かめるためにarchを別PCにセットアップしました。VirtualBoxとか使うのも考えましたが、VM使うとUSB機器のバインドまわりでハマりそうだったのと、ちょうどOS入れ直したいマシンがあったのでそのマシンを使うことにしました。</p>

<p><code>yay</code> や <code>git</code> 入れたりssh鍵の設定したりしてarchのセットアップがそこそこ済んでから、以下のようにコマンドを叩いてファームウェアを書き込む準備をしました。</p>

<pre><code class="language-console">$ git clone https://github.com/qmk/qmk_firmware.git
$ cd qmk_firmware
$ ./util/qmk_install.sh
$ yay -S avrdude
</code></pre>

<p>その後、<code>sudo make ergo42/rev1:default:avrdude</code> （archでは <code>sudo</code> が必要）して、先程のprogrammer関連のエラーが出なくなったことを確認しました。</p>

<p>しかし、その後に <code>address 0x800201 out of range at line 1080 of .build/ergo42_rev1_default.hex</code> というエラーが出て書き込みができませんでした。エラーメッセージでぐぐると、 <a href="https://syossan.hateblo.jp/entry/2018/09/16/031703">avr-gccのバージョンが8.2だと動かない</a>という情報を見つけました。コンパイルで想定しないメモリ空間にアクセスするようなファイルになってたりするんですかね？（この辺はファームウェアのコード読んだりしないとわからなさそう）</p>

<p>で、どうやら8.1.0まで <code>avr-gcc</code> のバージョンをダウングレードしたらよさそうだったので、以下のような作業をしました。</p>

<pre><code class="language-console">$ yay -S downgrade # パッケージをダウングレードするためのライブラリ（ https://syossan.hateblo.jp/entry/2018/09/16/031703 ）
$ downgrade avr-gcc
</code></pre>

<p>で <code>avr-gcc-8.1.0-1-x86_64</code> にダウングレードしました。</p>

<p>（しかし、今確認したところ、 <code>./util/qmk_install.sh</code> で <code>avr-gcc</code>8.1.0-1-x86_64` をインストールしてるように見えるので、試行錯誤中にアップデートしてたのかもです。。）</p>

<p>その後、次のコマンドで再ビルドからの書き込みをやってみたところ無事に成功し、キースイッチを押したら反応するようになりました。</p>

<pre><code class="language-console">$ sudo make clean
$ sudo make ergo42/rev1:default:avrdude
</code></pre>

<p>この後はMacにつないでも正しく反応しました。karabiner elementsのEventViewerで確認しましたが全キーが正しく反応しているようです。</p>

<h3 id="結論">結論</h3>

<ul>
<li>Macだとprogrammerが応答しなかったのは謎→（追記） <code>brew tap</code> 漏れが原因でした。逆に言うと↑みたいなエラーが出たらそのへん疑えば良さそう

<ul>
<li>OS依存なのか他の何かなのかわからないけど、 <code>avrdude</code> のバージョンに差異がなく、もちろんハード的に変化があるわけではないので他はOSぐらいしかない気がする&hellip;あとはなんか入れ忘れてるとかかな&hellip;→（追記）入れ忘れてました</li>
</ul></li>
<li>その後のファームウェア書き込み失敗は <code>avr-gcc</code> のバージョン問題でした</li>
</ul>

<h2 id="まとめ">まとめ</h2>

<p>これからキーマップ考えます。毎回このキーボードが使えるわけでもないので基本はQWERTYから変えないとは思いますが、kinesisで快適だったので親指でEnter押すようにしようと思っています。あと最近SKK始めたのでShiftの位置も考えたいです。Ctrlは小指なのでこのままだと左手の小指が危ない。</p>

      
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container has-text-right">
    
    <div class="addthis_inline_share_toolbox"></div>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/yoshihara">yoshihara</a> 2017-2018</p>
    
    <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>




<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4ac93ed1b0ded1"></script>

</body>
</html>

