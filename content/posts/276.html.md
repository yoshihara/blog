---
title: "このブログ情報まとめ"
category: 
tags: 
created_at: 2017-11-24 23:54:36 +0900
updated_at: 2017-11-25 02:38:59 +0900
published: true
number: 276
---

- blogリポジトリ： https://github.com/yoshihara/blog
- ホスティングしてるGitHub Pagesのリポジトリ：https://github.com/yoshihara/yoshihara.github.io

GitHub Pagesのリポジトリをsubmoduleとしてblogリポジトリの `public/` ディレクトリに置いている。

## 記事作成のながれ

1. esaで `blog/` カテゴリに記事を書いて Ship It! する
1. webhookで blog リポジトリの `contents/posts/` に記事のmarkdownファイルがpushされる
1. CircleCIがそのコミットをトリガーにしてCIを走らせる
    1. CIの中で静的サイトジェネレータの `hugo` をインストール（aptで入れると古くてテンプレートが使えないのでGitHubから持ってきている）
    1. ちょっとmarkdownファイルに小細工してからインストールした `hugo` でサイトを（GitHub Pagesがある） `public/` ディレクトリ配下に生成する
    1. submodule に対してコミット、pushする（ `cd public/ &&` すると親への変更になぜかみなされたので `--git-dir` を指定してディレクトリ移動しないようにしている。あとコミット直後にdetached HEADになるので `git submodule update -i` した後にmasterを明示的に見ている）
    1. GItHub Pagesの更新により、blog リポジトリの `public` の示す先が変わっているのでそちらをコミットしてpushする（普通にpushするとCIが走ってしまうので `[ci skip]` をつける）
1. Github Pagesのリポジトリが更新されるのでそれにしたがってこのブログも更新される

### 小細工の内訳

hugoでいい感じに記事を作るためにCIでシェルスクリプトを実行して小細工してます。

- ファイル内の `^created_at:` を `date:` に置き換える
    - hugo が記事の日時と認識するキーが `date` なのでそれに合わせて調整
- ファイルタイトルを `#{id}.html.md` から `#{id}.md` にする
    - hugo のURLだとたとえば `https://yoshihara.github.io/posts/276.html/` みたいになってなんか微妙だったので

## TODO

- 独自ドメイン
- もうちょいデプロイ周り綺麗にしたい
